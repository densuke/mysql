# MySQLのイメージ(授業用)

某授業で利用するMySQLデータベースサーバーのイメージです。
ベースイメージは、Docker Hubで公開されている公式のものを使っています。

- [MySQL Docker Hub](https://hub.docker.com/_/mysql)

ここに自作のヘルスチェック用スクリプトを内蔵させた構造になっており、
必要であればこちらを定期的に走らせることでコンテナが正常に機能しているかを簡易的に判断できるようにしています。

# 使い方

コンテナとしての起動方法は、オリジナルのものに準じています(そこは一切いじっていません)。

[公式側にあるイメージのドキュメント](https://hub.docker.com/_/mysql)を参照してください。

とりあえず試すのであれば、以下のコマンドラインのように行ってください。

```bash
$ docker run --rm --name mysql-test -e MYSQL_RANDOM_ROOT_PASSWORD=1 \
    -e MYSQL_DATABASE=test -e MYSQL_USER=test -e MYSQL_PASSWORD=test \
    -p 3306:3306 -d ghcr.io/densuke/mysql:latest
```

これでローカルの3306/tcpからコンテナ内のMySQLに接続できるようになります。

## ヘルスチェックについて

現状のヘルスチェックは自動起動(DockerfileによるHEALTHCHEK)は行っておりません。
外部から注入する形での起動となります。

動作しているコンテナが `mysql-test` であれば、以下の方法で確認できます。

```bash
$ docker exec -it mysql-test healthcheck.sh
```

### ヘルスチェックの注意

単純にDBに接続できるかのテスト(pingレベル)となっています、内容のチェック等は行いません。

- 通常は授業の関係でdbとして起動することが多いため『dbというコンテナホスト名で繋がるか』をテストしています
- コンテナ名が異なる場合は、localhostでの再接続をテストしています

いずれかで成功すればOKとなる実装です。


# 更新について

このイメージは、不定期に更新が入ります。

- dependabotによるベースイメージの更新に連動
- ヘルスチェックスクリプトの更新
- その他必要に応じて(作者の気の向くままに)

# 保証・再利用について

このイメージは、無保証で提供されています。再利用する場合は、自己責任で行ってください。オープンなイメージとなっておりますので、自由に改変・再配布が可能です。
Community Editionのライセンスに準じてGPLv2にて配布します。

# おねがい

できれば『このDockerイメージ使いますね』の一言がいただければ幸いです。


